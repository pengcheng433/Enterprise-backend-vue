import{D as O}from"../index/index.78072cb3.js";import{D as W}from"../index/index.41c9881b.js";import{M as X,B as Y,P as $}from"../@element-plus/@element-plus.01e950e2.js";import{h as _}from"../../assets/index-30bdac58.js";import{c as ee}from"../productsCategory/productsCategory.4a144398.js";import{D as te}from"../index/index.aae611ba.js";import{e as u,x as oe,l as b,k as U,c as I,a4 as o,_ as d,u as p,an as a,a2 as y,o as h,a as P,Q as re,ae,Z as L,a1 as le}from"../@vue/@vue.133e0034.js";import{l as m}from"../element-plus/element-plus.8d403dde.js";import"../news/news.8f1b56e5.js";import"../@ctrl/@ctrl.739734d8.js";import"../pinia/pinia.dbd2d364.js";import"../js-cookie/js-cookie.cf83ad76.js";import"../axios/axios.aba6f0e0.js";import"../geotiff/geotiff.41c905a7.js";import"../vue-router/vue-router.aebc008a.js";import"../fuse.js/fuse.js.88e2763d.js";import"../path-browserify/path-browserify.188d1ff8.js";import"../screenfull/screenfull.b3e6dc1f.js";import"../mitt/mitt.f7ef348c.js";import"../lodash-es/lodash-es.3689fb67.js";import"../@vueuse/@vueuse.902d2a47.js";import"../nprogress/nprogress.71449f25.js";/* empty css                                 */import"../clipboard/clipboard.860bb701.js";import"../vue-i18n/vue-i18n.dbf743d6.js";import"../@intlify/@intlify.771bffe6.js";import"../xe-utils/xe-utils.ae8f073f.js";import"../vxe-table/vxe-table.548b57f4.js";import"../vue3-lottie/vue3-lottie.24ecfee7.js";import"../lottie-web/lottie-web.c7050559.js";import"../@popperjs/@popperjs.d5d3bfa4.js";import"../dayjs/dayjs.aab16a72.js";import"../async-validator/async-validator.124ce023.js";import"../memoize-one/memoize-one.e2e9ba7a.js";import"../escape-html/escape-html.1d60d822.js";import"../normalize-wheel-es/normalize-wheel-es.2d7fa0bb.js";import"../@floating-ui/@floating-ui.c244c5cb.js";import"../vue/vue.b7c74ca4.js";import"../lodash-unified/lodash-unified.917db8bb.js";function ne(n){return _.request({method:"post",url:"/product/addProduct",data:n})}function se(n){return _.request({method:"get",url:"/product/getProductList",data:n})}function ie(n){return _.request({method:"get",url:"/product/getProductById",data:n})}function ce(n){return _.request({method:"post",url:"/product/updateProduct",data:n})}function ue(n){return _.request({method:"post",url:"/product/deleteProduct",data:n})}function de(n){return _.request({method:"post",url:"/product/enableProduct",data:n})}const pe={class:"common-layout"},me={class:"flex-row"},ge={class:"flex justify-start leftbtn"},et={__name:"product",setup(n,{expose:N}){const w=u(!1);oe(()=>{c(),S()});const k=b({list:[]}),V=b({list:[],label:"name",value:"id"}),S=async()=>{const{data:e}=await ee();k.list=e,V.list=e},j=U(()=>r.id?"修改产品":"添加产品"),r=b({name:"",conver_img:"",category_id:"",price:"",description:""}),Q=u([{prop:"name",label:"产品型号",rules:[{required:!0,message:"必须输入产品型号",trigger:"blur"}]},{prop:"conver_img",label:"产品缩略图",is:"upload"},{prop:"category_id",is:"select",option:V,label:"产品种类",rules:[{required:!0,message:"必须选择产品种类",trigger:"blur"}]},{prop:"price",label:"价格",is:"number"},{prop:"description",label:"详细介绍",is:"textarea"}]),g=u(!1),c=async()=>{w.value=!0;const{data:e}=await se(i);w.value=!1,B.value=e.data,x.value=e.total},B=u([]),v=u(null),M=U(()=>{var e;return((e=v==null?void 0:v.value)==null?void 0:e.multipleSelection)||[]}),R=u([{type:"selection"},{prop:"id",label:"ID",width:80},{prop:"name",label:"产品型号"},{prop:"conver_img",label:"封面预览",render:e=>o("div",{class:"image-container-news"},[e.conver_img?o(a("el-image"),{src:e.conver_img,fit:"cover","z-index":10001,"preview-src-list":[e.conver_img],"preview-teleported":!0},null):"无"])},{prop:"category_id",label:"产品分类",render:e=>(k.list.find(s=>s.id==e.category_id)||{name:""}).name},{prop:"created_at",label:"创建时间"},{prop:"updated_at",label:"修改时间"},{width:120,prop:"state",label:"状态",render:e=>o("div",null,[e.state==1?"启用":"禁用"])},{prop:"setting",label:"操作",render:e=>o("div",{class:"flex"},[o(a("el-button"),{type:"primary",onClick:()=>A(e)},{default:()=>[y("编辑")]}),e.state==1?o(a("el-button"),{type:"warning",onClick:()=>T(e)},{default:()=>[y("禁用")]}):o(a("el-button"),{type:"success",onClick:()=>T(e)},{default:()=>[y("启用")]}),o(a("el-button"),{type:"danger",onClick:()=>E(e)},{default:()=>[y("删除")]})])}]),q=u(""),Z=async()=>{if(await q.value.form.validate())if(r.id){const t=await ce(r);t.data&&(m.ElMessage({message:t.msg,type:"success"}),g.value=!1,c())}else{const t=await ne(r);t.data?(m.ElMessage({message:t.msg,type:"success"}),g.value=!1,c()):m.ElMessage.error(t.msg)}},A=async e=>{const t=await ie({id:e.id}),{id:s,name:C,description:z,conver_img:f,price:D,category_id:F}=t.data;r.id=s,r.name=C,r.conver_img=f,r.category_id=F,r.price=D,r.description=z,g.value=!0},E=e=>{const t=M.value.length>0?M.value.map(s=>s.id):[e.id];if(t.length==0||t[t.length-1]==null){m.ElMessage.warning("至少选中一条数据");return}m.ElMessageBox.confirm("确定要删除这些选中产品吗吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await ue({ids:t})).code==200&&(m.ElMessage({type:"success",message:"删除成功"}),c())})},x=u(0),i=b({search:"",category:"",pagesize:10,currentPage:1}),T=async e=>{const{id:t}=e,s=await de({id:t});s.data&&(m.ElMessage({type:"success",message:s.msg}),c())},G=()=>{r.id="",r.name="",r.conver_img="",r.category_id="",r.price="",r.description="",g.value=!0};return N({tableItemSelectionRef:v}),(e,t)=>{const s=a("el-input"),C=a("el-option"),z=a("el-select"),f=a("el-button"),D=a("el-row"),F=a("el-header"),H=a("el-pagination"),J=a("el-main"),K=a("el-container");return h(),I("div",pe,[o(K,null,{default:d(()=>[o(F,{class:"h-auto"},{default:d(()=>[o(D,{class:"flex-row flex-between"},{default:d(()=>[P("div",me,[o(s,{class:"w-50",modelValue:i.search,"onUpdate:modelValue":t[0]||(t[0]=l=>i.search=l),placeholder:"输入产品名称"},null,8,["modelValue"]),o(z,{class:"w-50 ml-1",modelValue:i.category,"onUpdate:modelValue":t[1]||(t[1]=l=>i.category=l),placeholder:"选择分类",size:"large",clearable:""},{default:d(()=>[(h(!0),I(re,null,ae(k.list,l=>(h(),L(C,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{class:"ml-2",icon:p(X),circle:"",onClick:c},null,8,["icon"])]),P("div",null,[o(f,{type:"primary",icon:p(Y),circle:"",onClick:G},null,8,["icon"]),o(f,{type:"danger",icon:p($),circle:"",onClick:E},null,8,["icon"])])]),_:1})]),_:1}),o(J,null,{default:d(()=>[o(p(te),{loading:w.value,ref_key:"tableItemSelectionRef",ref:v,"table-data":B.value,"table-title":R.value},null,8,["loading","table-data","table-title"]),x.value>10?(h(),L(H,{key:0,class:"flex justify-end","current-page":i.currentPage,"onUpdate:currentPage":t[2]||(t[2]=l=>i.currentPage=l),"page-size":i.pagesize,"onUpdate:pageSize":t[3]||(t[3]=l=>i.pagesize=l),background:!0,"page-sizes":[10,25,50,100],layout:"total,sizes, prev, pager, next",total:x.value,onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])):le("",!0)]),_:1})]),_:1}),o(p(O),{visible:g.value,"onUpdate:visible":t[4]||(t[4]=l=>g.value=l),title:p(j),width:"60%","destroy-on-close":""},{default:d(()=>[P("div",null,[o(p(W),{"form-items":Q.value,form:r,rules:e.formRules,ref_key:"customFormref",ref:q},null,8,["form-items","form","rules"]),P("div",ge,[o(f,{type:"primary",onClick:Z},{default:d(()=>[y("确定")]),_:1})])])]),_:1},8,["visible","title"])])}}};export{et as default};
