import{l as Ne}from"../@province-city-china/@province-city-china.0e7ba57a.js";import{D as se}from"../index/index.78072cb3.js";import{D as oe}from"../index/index.41c9881b.js";import{M as Oe,B as Qe,S as Ke}from"../@element-plus/@element-plus.01e950e2.js";import{h as b,g as $e}from"../../assets/index-30bdac58.js";import{c as je}from"../productsCategory/productsCategory.4a144398.js";import{D as We}from"../index/index.aae611ba.js";import{e as c,l as y,x as Ze,f as Ge,k as ie,c as I,a4 as l,_ as n,u as h,an as o,a2 as g,au as He,o as v,a as d,Q as M,ae as R,Z as z,a1 as Je,a3 as D,V as Xe,$ as Ye}from"../@vue/@vue.133e0034.js";import{l as C}from"../element-plus/element-plus.8d403dde.js";import"../@ctrl/@ctrl.739734d8.js";import"../news/news.8f1b56e5.js";import"../pinia/pinia.dbd2d364.js";import"../js-cookie/js-cookie.cf83ad76.js";import"../axios/axios.aba6f0e0.js";import"../geotiff/geotiff.41c905a7.js";import"../vue-router/vue-router.aebc008a.js";import"../fuse.js/fuse.js.88e2763d.js";import"../path-browserify/path-browserify.188d1ff8.js";import"../screenfull/screenfull.b3e6dc1f.js";import"../mitt/mitt.f7ef348c.js";import"../lodash-es/lodash-es.3689fb67.js";import"../@vueuse/@vueuse.902d2a47.js";import"../nprogress/nprogress.71449f25.js";/* empty css                                 */import"../clipboard/clipboard.860bb701.js";import"../vue-i18n/vue-i18n.dbf743d6.js";import"../@intlify/@intlify.771bffe6.js";import"../xe-utils/xe-utils.ae8f073f.js";import"../vxe-table/vxe-table.548b57f4.js";import"../vue3-lottie/vue3-lottie.24ecfee7.js";import"../lottie-web/lottie-web.c7050559.js";import"../@popperjs/@popperjs.d5d3bfa4.js";import"../dayjs/dayjs.aab16a72.js";import"../async-validator/async-validator.124ce023.js";import"../memoize-one/memoize-one.e2e9ba7a.js";import"../escape-html/escape-html.1d60d822.js";import"../normalize-wheel-es/normalize-wheel-es.2d7fa0bb.js";import"../@floating-ui/@floating-ui.c244c5cb.js";import"../vue/vue.b7c74ca4.js";import"../lodash-unified/lodash-unified.917db8bb.js";function et(u){return b.request({method:"get",url:"/client/getClientList",data:u})}function tt(u){return b.request({url:"/client/addClient",method:"post",data:u})}function lt(u){return b.request({url:"/client/createFollowUpRecord",method:"post",data:u})}function re(u){return b.request({url:"/client/getClientFollowUpRecords",method:"get",data:u})}function at(u){return b.request({url:"/client/findClient",method:"get",data:u})}function nt(u){return b.request({url:"/client/updatedClient",method:"post",data:u})}function ue(u){return b.request({url:"/client/changeSea",method:"post",data:u})}function st(u){return b.request({url:"/client/transferOwnClient",method:"post",data:u})}function ot(u){return b.request({url:"/client/assignClient",method:"post",data:u})}function it(u){return b.request({url:"/client/changgeDeal",method:"post",data:u})}const rt={class:"common-layout"},ut={class:"flex-row"},ct={class:"flex justify-start leftbtn"},dt={class:"dialog-footer"},pt=["id"],mt=d("div",null,null,-1),ft={class:"flex justify-start leftbtn1"},tl={__name:"clientsList",setup(u,{expose:ce}){const Y=c(""),A=c(!1),de=async()=>{const e=await Y.value.validate(),t=K.value.length!=0?K.value.map(r=>r.id):F.client_id;if(e)if(F.assignValue==0){const s=await ue({clientIds:t});s.data&&(f(),C.ElMessage.success(s.msg),x.value=!1)}else{const s=await ot({clientIds:t,userId:F.assignValue});f(),C.ElMessage.success(s.msg),x.value=!1}},pe=async e=>{const t=q.customer_id,s=await it({id:t,hasDeal:e?1:0});console.log(s),s.data&&f()},me=localStorage.getItem("uid"),P=y({list:[]}),fe=e=>ee.list.find(r=>r.id==e).name,B=c(!1),_e=(e,t)=>{function r(s){for(const p in s)if(typeof s[p]=="object"&&Array.isArray(s[p]))s[p].forEach(m=>r(m));else if(typeof s[p]=="object"&&s[p]!==null)r(s[p]);else if(p in t){const m=t[p];s[m]=s[p],delete s[p]}}return e.forEach(s=>r(s)),e},ge=()=>{console.log(),K.value.length!==0?x.value=!0:C.ElMessage.warning("至少选中一条数据")},N=c(!1);Ze(async()=>{f(),await ve(),console.log(L.value),O.value.push({label:"销售列表",options:L.value}),console.log(O.value),ye(),P.list=_e(Ne,{code:"value",name:"label"})});const L=c([]),O=c([{label:"公海",options:[{userid:"0",username:"公海"}]}]),F=y({client_id:[],assignValue:""}),ve=async()=>{const e=await $e();L.value=e.data};Ge(P,e=>{te.value.forEach(t=>{t.is==="cascader"&&(t.options=e.list)})});const be=y({list:[]}),Q=y({list:[{name:"潜在客户",id:"1"},{name:"正式客户",id:"2"},{name:"老客户",id:"3"},{name:"暂停客户",id:"4"},{name:"停止合作客户",id:"5"},{name:"其他",id:"6"}],label:"name",value:"id"}),ee=y({list:[{id:1,name:"微信/QQ/社交软件"},{id:2,name:"电话"},{id:3,name:"上门拜访"},{id:4,name:"邮箱"}],label:"name",value:"id"}),ye=async()=>{const{data:e}=await je();be.list=e},he=ie(()=>i.id?"修改客户":"添加客户"),i=y({name:"",conver_img:"",price:"",description:"",address_zh:[],phone:"",email:"",status:"",address_en:"",company_name:""}),q=y({customer_id:"",date:"",content:"",next_contact_date:"",contact_method:""}),we=c([{prop:"contact_method",is:"select",option:ee,label:"跟进方式",span:12,rules:[{required:!0,message:"选择跟进方式",trigger:"blur"}]},{prop:"date",is:"datetime",label:"跟进日期",span:12,rules:[{required:!0,message:"选择跟进日期",trigger:"blur"}]},{prop:"content",label:"跟进记录",type:"textarea",span:12},{prop:"next_contact_date",is:"datetime",label:"下次拜访记录",span:12,rules:[{required:!0,message:"选择拜访记录",trigger:"blur"}]}]),te=c([{prop:"name",label:"客户名称",span:8,rules:[{required:!0,message:"必须输入客户名称",trigger:"blur"}]},{prop:"description",label:"备注",type:"textarea",span:8},{prop:"conver_img",label:"客户头像",is:"upload",span:8},{prop:"phone",label:"联系电话",span:8},{prop:"company_name",label:"公司名称",span:8},{prop:"email",label:"客户邮箱",span:8},{prop:"status",is:"select",option:Q,label:"客户状态",span:8,rules:[{required:!0,message:"必须选择客户状态",trigger:"blur"}]},{prop:"address_zh",is:"cascader",options:P.list,span:8,label:"国内地址"},{prop:"address_details",label:"详细地址",placeholder:"请输入详细地址",span:12},{prop:"address_en",label:"国外地址",placeholder:"手动输入客户国外地址",span:12}]),k=c(!1),x=c(!1),f=async()=>{N.value=!0;const{data:e}=await et(_);N.value=!1,le.value=e.data,$.value=e.total},le=c([]),U=c(null),K=ie(()=>{var e;return((e=U==null?void 0:U.value)==null?void 0:e.multipleSelection)||[]}),Ce=c([{type:"selection"},{prop:"id",label:"ID",width:80},{prop:"name",label:"客户名称",width:220,render:e=>l("div",null,[e.has_deal?l("span",{class:"dealTitle"},[g("成交")]):null,l("span",null,[e.name])])},{prop:"company_name",label:"客户公司",width:220},{prop:"phone",width:220,label:"电话"},{width:150,prop:"status",label:"客户分类",render:e=>{const t=Q.list.find(r=>r.id==e.status)||{name:"",id:7};return l(o("el-alert"),{class:t.id==1?"blueCalss":"",title:t.name,type:t.id==1?"success":t.id==2?"warning":t.id==3?"success":t.id==4|5?"error":"info",effect:"dark",closable:!1},null)}},{width:150,prop:"belong_sea",label:"客户归属",render:e=>{const t=e.belong_sea,r=L.value.find(s=>s.userid==e.userid)||{username:""};return t==0?"公海":r.username}},{width:170,prop:"updated_at",label:"下次联系时间"},{width:170,prop:"created_at",label:"创建时间"},{width:170,prop:"updated_at",label:"客户分配时间"},{width:170,prop:"updated_at",label:"最后联系时间"},{prop:"setting",label:"操作",width:400,render:e=>l("div",{class:"flex"},[l(o("el-button"),{type:"primary",onClick:()=>Be(e)},{default:()=>[g("编辑")]}),e.belong_sea==1?l(o("el-button"),{type:"success",onClick:()=>Ve(e)},{default:()=>[g("转移到公海")]}):l(o("el-button"),{type:"success",onClick:()=>ke(e)},{default:()=>[g("跟进客户")]}),l(o("el-button"),{type:"success",onClick:()=>Fe(e)},{default:()=>[g("分配客户")]}),e.belong_sea==1?l(o("el-button"),{type:"success",onClick:()=>qe(e)},{default:()=>[g("跟进记录")]}):""])}]),Fe=e=>{F.client_id=[e.id],x.value=!0},ae=c(""),ne=c(""),xe=async()=>{if(await ae.value.form.validate())if(i.id){const t=await nt(i);t.data&&(C.ElMessage({message:t.msg,type:"success"}),k.value=!1,f())}else{const t=await tt(i);t.data?(C.ElMessage({message:t.msg,type:"success"}),k.value=!1,f()):C.ElMessage.error(t.msg)}},Ve=e=>{C.ElMessageBox.confirm("确定要转移到客户公海吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await ue({clientIds:[e.id]})).data&&f()})},De=async()=>{if(await ne.value.form.validate()){const t={...q,user_id:me};(await lt(t)).data&&ze()}},ke=e=>{C.ElMessageBox.confirm("确定要转移成自己的客户吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await st({clientIds:[e.id]})).data&&f()})},ze=async()=>{B.value=!0;const e=await re({client_id:q.customer_id});W.value=e.data,B.value=!1},Be=async e=>{const t=await at({client_id:e.id}),{id:r,name:s,phone:p,email:m,description:V,company_name:Z,conver_img:G,address_zh:S,address_en:H,status:J,address_details:X}=t.data;i.id=r,i.name=s,i.phone=p,i.email=m,i.conver_img=G,i.address_zh=S==null?void 0:S.split(","),i.address_en=H,i.status=J,i.company_name=Z,i.description=V,i.address_details=X,k.value=!0},$=c(""),_=y({search:"",status:"",pagesize:10,currentPage:1,type:"1"}),j=c(!1),E=y({name:"",company_name:""}),W=c([]),qe=async e=>{B.value=!0,q.customer_id=e.id,E.name=e.name,E.company_name=e.company_name,j.value=!0,console.log(E),A.value=!!e.has_deal;const t=await re({client_id:e.id});W.value=t.data,B.value=!1},Ue=()=>{i.id="",i.name="",i.conver_img="",i.address_zh=[],i.description="",i.phone="",i.email="",i.status="",i.address_en="",k.value=!0};return ce({tableItemSelectionRef:U}),(e,t)=>{const r=o("el-option"),s=o("el-select"),p=o("el-input"),m=o("el-button"),V=o("el-row"),Z=o("el-header"),G=o("el-pagination"),S=o("el-main"),H=o("el-container"),J=o("el-option-group"),X=o("el-form-item"),Ee=o("el-form"),w=o("el-col"),Se=o("Document"),Te=o("el-icon"),Ie=o("el-switch"),Le=o("el-card"),Me=o("el-timeline-item"),Re=o("el-timeline"),Ae=o("el-drawer"),Pe=He("loading");return v(),I("div",rt,[l(H,null,{default:n(()=>[l(Z,{class:"h-auto"},{default:n(()=>[l(V,{class:"flex-row flex-between"},{default:n(()=>[d("div",ut,[l(s,{modelValue:_.type,"onUpdate:modelValue":t[0]||(t[0]=a=>_.type=a),class:"ml-2",placeholder:"",size:"large",onChange:f},{default:n(()=>[l(r,{label:"客户公海",value:"0",key:"0"}),l(r,{label:"我的客户",value:"1",key:"1"})]),_:1},8,["modelValue"]),l(p,{class:"w-50 ml-2",modelValue:_.search,"onUpdate:modelValue":t[1]||(t[1]=a=>_.search=a),placeholder:"输入客户名称&手机&邮箱&公司名"},null,8,["modelValue"]),l(s,{modelValue:_.status,"onUpdate:modelValue":t[2]||(t[2]=a=>_.status=a),class:"ml-2",placeholder:"客户类型",size:"large",clearable:""},{default:n(()=>[(v(!0),I(M,null,R(Q.list,a=>(v(),z(r,{key:a,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(m,{class:"ml-2",icon:h(Oe),circle:"",onClick:f},null,8,["icon"])]),d("div",null,[l(m,{type:"primary",icon:h(Qe),circle:"",onClick:Ue},null,8,["icon"]),l(m,{type:"success",icon:h(Ke),circle:"",onClick:ge},null,8,["icon"])])]),_:1})]),_:1}),l(S,null,{default:n(()=>[l(h(We),{loading:N.value,ref_key:"tableItemSelectionRef",ref:U,"table-data":le.value,"table-title":Ce.value},null,8,["loading","table-data","table-title"]),$.value>10?(v(),z(G,{key:0,class:"flex justify-end","current-page":_.currentPage,"onUpdate:currentPage":t[3]||(t[3]=a=>_.currentPage=a),"page-size":_.pagesize,"onUpdate:pageSize":t[4]||(t[4]=a=>_.pagesize=a),background:!0,"page-sizes":[10,25,50,100],layout:"total,sizes, prev, pager, next",total:$.value,onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])):Je("",!0)]),_:1})]),_:1}),l(h(se),{visible:k.value,"onUpdate:visible":t[5]||(t[5]=a=>k.value=a),title:h(he),width:"60%","destroy-on-close":""},{default:n(()=>[d("div",null,[l(h(oe),{"form-items":te.value,form:i,rules:e.formRules,ref_key:"customFormref",ref:ae},null,8,["form-items","form","rules"]),d("div",ct,[l(m,{type:"primary",onClick:xe},{default:n(()=>[g("确定")]),_:1})])])]),_:1},8,["visible","title"]),l(h(se),{visible:x.value,"onUpdate:visible":t[8]||(t[8]=a=>x.value=a),title:"分配客户",width:"30%","destroy-on-close":""},{footer:n(()=>[d("span",dt,[l(m,{onClick:t[7]||(t[7]=a=>x.value=!1)},{default:n(()=>[g("退出")]),_:1}),l(m,{type:"primary",onClick:de},{default:n(()=>[g(" 分配 ")]),_:1})])]),default:n(()=>[l(V,null,{default:n(()=>[l(w,{span:24},{default:n(()=>[l(Ee,{model:F,"label-width":"120px",ref_key:"assignFormRef",ref:Y,rules:{assignValue:[{required:!0,message:"请选择分配类型/人员",trigger:"blur"}]}},{default:n(()=>[l(X,{label:"分配类型/人员",prop:"assignValue"},{default:n(()=>[l(s,{modelValue:F.assignValue,"onUpdate:modelValue":t[6]||(t[6]=a=>F.assignValue=a),placeholder:"选择公海或者业务员"},{default:n(()=>[(v(!0),I(M,null,R(O.value,a=>(v(),z(J,{key:a.label,label:a.label},{default:n(()=>[(v(!0),I(M,null,R(a.options,T=>(v(),z(r,{key:T.userid,label:T.username,value:T.userid},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1},8,["visible"]),l(Ae,{modelValue:j.value,"onUpdate:modelValue":t[10]||(t[10]=a=>j.value=a),direction:"rtl",size:"50%"},{header:n(({titleId:a,titleClass:T})=>[d("h3",{id:a,class:Xe(T)},[l(V,{gutter:20},{default:n(()=>[l(w,{span:1},{default:n(()=>[l(Te,{class:"iconlg"},{default:n(()=>[l(Se)]),_:1})]),_:1}),l(w,{span:6},{default:n(()=>[d("div",null,D(E.company_name),1),d("div",null,D(E.name),1)]),_:1})]),_:1}),mt],10,pt)]),default:n(()=>[l(V,{gutter:20},{default:n(()=>[l(w,{span:20},{default:n(()=>[l(Ie,{onChange:pe,style:{margin:"0px 0px 12x 50px","--el-switch-on-color":"#13ce66","--el-switch-off-color":"gray"},modelValue:A.value,"onUpdate:modelValue":t[9]||(t[9]=a=>A.value=a),size:"large","inactive-text":"是否成交客户"},null,8,["modelValue"])]),_:1})]),_:1}),d("div",null,[l(h(oe),{"form-items":we.value,form:q,rules:e.formRulesFollow,ref_key:"customFormrefFollow",ref:ne,labelWidth:120},null,8,["form-items","form","rules"]),d("div",ft,[l(m,{type:"primary",onClick:De},{default:n(()=>[g("添加跟进记录")]),_:1})])]),Ye((v(),z(Re,{style:{"margin-top":"28px"},"element-loading-text":"加载中...","element-loading-spinner":e.svg,"element-loading-svg-view-box":"-10, -10, 50, 50","element-loading-background":"rgba(122, 122, 122, 0.8)"},{default:n(()=>[(v(!0),I(M,null,R(W.value,a=>(v(),z(Me,{key:a,timestamp:a.created_at,placement:"top",size:"large",color:"#0bbd87"},{default:n(()=>[l(Le,null,{default:n(()=>[d("h3",null,D(a.context||""),1),l(V,{gutter:20,style:{"margin-top":"10px"}},{default:n(()=>[l(w,{span:5},{default:n(()=>[d("span",null,"拜访人:"+D(a.user_name||""),1)]),_:2},1024),l(w,{span:5},{default:n(()=>[d("span",null,"拜访方式:"+D(fe(a.contact_method)||""),1)]),_:2},1024),l(w,{span:5},{default:n(()=>[d("span",null," 拜访日期:"+D(a.date||""),1)]),_:2},1024),l(w,{span:5},{default:n(()=>[g(" 下次拜访日期:"+D(a.next_contact_date||""),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1},8,["element-loading-spinner"])),[[Pe,B.value]])]),_:1},8,["modelValue"])])}}};export{tl as default};
