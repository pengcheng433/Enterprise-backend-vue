import{M as R,B as Z,P as A}from"../@element-plus/@element-plus.01e950e2.js";import{g as G,s as H,c as J,d as K,e as O}from"./news.8f1b56e5.js";import{c as W}from"../newCategory/newCategory.d8bef9d4.js";import{D as X}from"../index/index.aae611ba.js";import{f as Y}from"../fomattime/fomattime.dd6f399c.js";import{a as $}from"../vue-router/vue-router.aebc008a.js";import{e as p,x as ee,l as N,k as te,c as z,a4 as t,_ as d,an as o,a2 as i,o as g,a as V,Q as ae,ae as oe,u as f,Z as E,a1 as le}from"../@vue/@vue.133e0034.js";import{l as c}from"../element-plus/element-plus.8d403dde.js";import"../@ctrl/@ctrl.739734d8.js";import"../../assets/index-30bdac58.js";import"../pinia/pinia.dbd2d364.js";import"../js-cookie/js-cookie.cf83ad76.js";import"../axios/axios.aba6f0e0.js";import"../geotiff/geotiff.41c905a7.js";import"../fuse.js/fuse.js.88e2763d.js";import"../path-browserify/path-browserify.188d1ff8.js";import"../screenfull/screenfull.b3e6dc1f.js";import"../mitt/mitt.f7ef348c.js";import"../lodash-es/lodash-es.3689fb67.js";import"../@vueuse/@vueuse.902d2a47.js";import"../nprogress/nprogress.71449f25.js";/* empty css                                 */import"../clipboard/clipboard.860bb701.js";import"../vue-i18n/vue-i18n.dbf743d6.js";import"../@intlify/@intlify.771bffe6.js";import"../xe-utils/xe-utils.ae8f073f.js";import"../vxe-table/vxe-table.548b57f4.js";import"../vue3-lottie/vue3-lottie.24ecfee7.js";import"../lottie-web/lottie-web.c7050559.js";import"../@popperjs/@popperjs.d5d3bfa4.js";import"../dayjs/dayjs.aab16a72.js";import"../async-validator/async-validator.124ce023.js";import"../memoize-one/memoize-one.e2e9ba7a.js";import"../escape-html/escape-html.1d60d822.js";import"../normalize-wheel-es/normalize-wheel-es.2d7fa0bb.js";import"../@floating-ui/@floating-ui.c244c5cb.js";import"../vue/vue.b7c74ca4.js";import"../lodash-unified/lodash-unified.917db8bb.js";const ne={class:"common-layout"},se={class:"flex-row"},He={__name:"newsList",setup(re,{expose:F}){const w=$(),_=p(!1);ee(()=>{r(),T()});const y=N({list:[]}),r=async()=>{_.value=!0;const{data:e}=await G(s);_.value=!1,h.value=e.data,b.value=e.total},T=async()=>{const{data:e}=await W();y.list=e},h=p([]),u=p(null),k=te(()=>{var e;return((e=u==null?void 0:u.value)==null?void 0:e.multipleSelection)||[]}),B=p([{type:"selection"},{prop:"id",label:"ID",width:80},{prop:"title",label:"标题"},{prop:"coverImage",label:"封面预览",render:e=>t("div",{class:"image-container-news"},[t(o("el-image"),{src:e.coverImage,fit:"cover","z-index":10001,"preview-src-list":[e.coverImage],"preview-teleported":!0},null)," "])},{prop:"category",label:"分类",width:150,render:e=>(y.list.find(l=>l.id==e.category)||{name:""}).name},{prop:"views",label:"点击数"},{width:120,prop:"state",label:"状态",render:e=>t("div",null,[e.state==1?"启用":"禁用"])},{prop:"publish_date",label:"发布日期",render:e=>t("div",null,[Y(e.publish_date)])},{prop:"setting",label:"操作",render:e=>t("div",{class:"flex"},[t(o("el-button"),{type:"primary",onClick:()=>I(e)},{default:()=>[i("编辑")]}),e.state==1?t(o("el-button"),{type:"warning",onClick:()=>x(e)},{default:()=>[i("禁用")]}):t(o("el-button"),{type:"success",onClick:()=>x(e)},{default:()=>[i("启用")]}),e.priority==0?t(o("el-button"),{type:"success",onClick:()=>M(e)},{default:()=>[i("置顶")]}):t(o("el-button"),{type:"warning",onClick:()=>D(e)},{default:()=>[i("取消置顶")]}),t(o("el-button"),{type:"danger",onClick:()=>C(e)},{default:()=>[i("删除")]})])}]),M=async e=>{const{id:a}=e,l=await H({newsId:a});l.data&&(c.ElMessage({type:"success",message:l.msg}),r())},D=async e=>{const{id:a}=e,l=await J({newsId:a});l.data&&(c.ElMessage({type:"success",message:l.msg}),r())},I=e=>{w.push({path:"/news/editNews",query:{id:e.id}}),console.log(e)},C=e=>{const a=k.value.length>0?k.value.map(l=>l.id):[e.id];if(a.length==0||a[a.length-1]==null){c.ElMessage.warning("至少选中一条数据");return}c.ElMessageBox.confirm("确定要删除这些选中文章吗吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await K({ids:a})).code==200&&(c.ElMessage({type:"success",message:"删除成功"}),r())})},b=p(0),s=N({search:"",category:"",pageSize:10,currentPage:1}),x=async e=>{console.log(e);const{id:a,state:l}=e,m=await O({id:a,enable:l});m.data&&(c.ElMessage({type:"success",message:m.msg}),r())},S=()=>{w.push({path:"/news/addnews"})};return F({tableItemSelectionRef:u}),(e,a)=>{const l=o("el-input"),m=o("el-option"),L=o("el-select"),v=o("el-button"),P=o("el-row"),U=o("el-header"),j=o("el-pagination"),q=o("el-main"),Q=o("el-container");return g(),z("div",ne,[t(Q,null,{default:d(()=>[t(U,{class:"h-auto"},{default:d(()=>[t(P,{class:"flex-row flex-between"},{default:d(()=>[V("div",se,[t(l,{class:"w-50",modelValue:s.search,"onUpdate:modelValue":a[0]||(a[0]=n=>s.search=n),placeholder:"输入标题"},null,8,["modelValue"]),t(L,{class:"w-50 ml-1",modelValue:s.category,"onUpdate:modelValue":a[1]||(a[1]=n=>s.category=n),placeholder:"选择分类",size:"large",clearable:""},{default:d(()=>[(g(!0),z(ae,null,oe(y.list,n=>(g(),E(m,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(v,{class:"ml-2",icon:f(R),circle:"",onClick:r},null,8,["icon"])]),V("div",null,[t(v,{type:"primary",icon:f(Z),circle:"",onClick:S},null,8,["icon"]),t(v,{type:"danger",icon:f(A),circle:"",onClick:C},null,8,["icon"])])]),_:1})]),_:1}),t(q,null,{default:d(()=>[t(f(X),{loading:_.value,ref_key:"tableItemSelectionRef",ref:u,"table-data":h.value,"table-title":B.value},null,8,["loading","table-data","table-title"]),b.value>10?(g(),E(j,{key:0,class:"flex justify-end","current-page":s.currentPage,"onUpdate:currentPage":a[2]||(a[2]=n=>s.currentPage=n),"page-size":s.pageSize,"onUpdate:pageSize":a[3]||(a[3]=n=>s.pageSize=n),background:!0,"page-sizes":[10,25,50,100],layout:"total,sizes, prev, pager, next",total:b.value,onSizeChange:r,onCurrentChange:r},null,8,["current-page","page-size","total"])):le("",!0)]),_:1})]),_:1})])}}};export{He as default};
