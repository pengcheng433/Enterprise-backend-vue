import{M as Y,B as ee,P as te}from"../@element-plus/@element-plus.01e950e2.js";import{U as se,c as re,f as le,d as ae,b as oe,e as ie,r as ne}from"../../assets/index-30bdac58.js";import{r as ue}from"../role/role.56a83efa.js";import{D as ce}from"../index/index.aae611ba.js";import{D as V}from"../index/index.78072cb3.js";import{D as U}from"../index/index.41c9881b.js";import{f as me}from"../fomattime/fomattime.dd6f399c.js";import{l as c}from"../element-plus/element-plus.8d403dde.js";import{x as pe,e as o,k as F,l as x,c as de,a4 as s,_ as i,u as n,an as u,a2 as p,o as fe,a as _}from"../@vue/@vue.133e0034.js";import"../@ctrl/@ctrl.739734d8.js";import"../pinia/pinia.dbd2d364.js";import"../js-cookie/js-cookie.cf83ad76.js";import"../axios/axios.aba6f0e0.js";import"../geotiff/geotiff.41c905a7.js";import"../vue-router/vue-router.aebc008a.js";import"../fuse.js/fuse.js.88e2763d.js";import"../path-browserify/path-browserify.188d1ff8.js";import"../screenfull/screenfull.b3e6dc1f.js";import"../mitt/mitt.f7ef348c.js";import"../lodash-es/lodash-es.3689fb67.js";import"../@vueuse/@vueuse.902d2a47.js";import"../nprogress/nprogress.71449f25.js";/* empty css                                 */import"../clipboard/clipboard.860bb701.js";import"../vue-i18n/vue-i18n.dbf743d6.js";import"../@intlify/@intlify.771bffe6.js";import"../xe-utils/xe-utils.ae8f073f.js";import"../vxe-table/vxe-table.548b57f4.js";import"../vue3-lottie/vue3-lottie.24ecfee7.js";import"../lottie-web/lottie-web.c7050559.js";import"../@popperjs/@popperjs.d5d3bfa4.js";import"../dayjs/dayjs.aab16a72.js";import"../async-validator/async-validator.124ce023.js";import"../memoize-one/memoize-one.e2e9ba7a.js";import"../escape-html/escape-html.1d60d822.js";import"../normalize-wheel-es/normalize-wheel-es.2d7fa0bb.js";import"../@floating-ui/@floating-ui.c244c5cb.js";import"../vue/vue.b7c74ca4.js";import"../lodash-unified/lodash-unified.917db8bb.js";import"../news/news.8f1b56e5.js";function ge(P){return P.map(y=>({value:y.id,label:y.name}))}const ve={class:"common-layout"},be={class:"flex-row"},we={class:"flex justify-end"},_e={class:"dialog-footer"},nt={__name:"userList",setup(P,{expose:y}){pe(()=>{$(),d()});const $=async()=>{const e=await ue({search:""});console.log(e),h.list=ge(e.data),h.list=h.list.filter(t=>t.id!==1)},d=async()=>{var t;const e=await se(C);console.log("userListr:",e),k.value=((t=e==null?void 0:e.data)==null?void 0:t.data)||[]},k=o([]),v=o(null),D=F(()=>{var e;return((e=v==null?void 0:v.value)==null?void 0:e.multipleSelection)||[]}),E=o(!1),q=F(()=>E.value?T.value:T.value.filter(e=>e.prop!=="pwd")),I=async e=>{const{userid:t}=e,{data:l}=await le({userid:t});r.userid=t,r.name=l.username,r.role=parseInt(l.role),r.useracount=l.useracount,r.mobile=l.mobile,r.email=l.email,E.value=!1,f.value=!0},L=o([{type:"selection"},{prop:"userid",label:"ID"},{prop:"useracount",label:"账号"},{prop:"username",label:"姓名"},{prop:"state",label:"状态",render:e=>s("div",null,[e.state==1?"启用":"禁用"])},{prop:"lastlogintime",label:"登陆时间",render:e=>s("div",null,[me(e.lastlogintime)])},{prop:"setting",label:"操作",render:e=>s("div",{class:"flex"},[s(u("el-button"),{type:"primary",onClick:()=>I(e)},{default:()=>[p("编辑")]}),e.state==1?s(u("el-button"),{type:"warning",onClick:()=>M(e)},{default:()=>[p("禁用")]}):s(u("el-button"),{type:"success",onClick:()=>M(e)},{default:()=>[p("启用")]}),s(u("el-button"),{type:"info",onClick:()=>Z(e)},{default:()=>[" ",p("密码重置")," "]})])}]),f=o(!1),B=o(null),b=o(null),w=o(!1),z=F(()=>r.userid?"编辑用户":"添加用户"),A=o("重置密码"),N=()=>{delete r.userid,r.name="",r.email="",r.role="",r.useracount="",r.mobile="",E.value=!0,f.value=!0},R=()=>{if(D.value.length==0){c.ElMessage.warning("至少选中一条数据");return}const e=D.value.map(t=>t.userid);console.log(e),c.ElMessageBox.confirm("确定要删除这些选中账户吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await ae({ids:e})).code==200&&(c.ElMessage({type:"success",message:"删除成功"}),d())})},Z=e=>{console.log(e),a.userid=e.userid,console.log(a),w.value=!0},M=e=>{const t=e.state==1?"禁用":"启用";c.ElMessageBox.confirm(`确定要对该账户进行${t}的操作吗`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await re({userid:e.userid})).code==200&&(c.ElMessage({type:"success",message:`${t}成功`}),d())})},h=x({list:[],border:!0,size:"large"}),T=o([{prop:"useracount",label:"账号",rules:[{required:!0,message:"必须输入账号",trigger:"blur"}]},{prop:"name",label:"姓名",rules:[{required:!0,message:"必须输入姓名",trigger:"blur"}]},{prop:"pwd",label:"密码",disabled:!0,rules:[{required:!0,message:"必须输入密码",trigger:"blur"}]},{prop:"email",label:"邮箱",placeholder:"输入邮箱"},{prop:"mobile",label:"手机号",placeholder:"输入手机号"},{prop:"role",is:"radio",option:h,label:"角色",rules:[{required:!0,message:"必须选择角色",trigger:"blur"}]}]),j=[{prop:"pwd",label:"密码",span:20,type:"password",showPassword:!0,rules:[{validator:(e,t,l)=>{var m=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/;if(a.pwd==="")l(new Error("输入密码"));else if(m.test(a.pwd)==!1)l(new Error("密码至少包含 数字和英文，长度6-20"));else{if(a.pwdagagin!==""){if(!b.value)return;b.value.$refs.form.validateField("pwdagagin",()=>null)}l()}},trigger:"blur",required:!0}]},{prop:"pwdagagin",label:"确认密码",span:20,type:"password",showPassword:!0,rules:[{validator:(e,t,l)=>{console.log(a.pwdagagin),a.pwdagagin===""?l(new Error("输入二次密码")):a.pwdagagin!==a.pwd?l(new Error("密码不一致")):l()},trigger:"blur",required:!0}]}],C=x({search:"",pagesize:10,currentPage:1}),r=x({name:"",email:"",pwd:123456,role:"",useracount:"",mobile:""}),S=async()=>{if(await B.value.form.validate())if(r.userid){const t=await oe(r);t.data&&(c.ElMessage({message:t.msg,type:"success"}),f.value=!1,d())}else{const t=await ie(r);t.data?(c.ElMessage({message:t.msg,type:"success"}),f.value=!1,d()):c.ElMessage.error(t.msg)}},X=async()=>{if(await b.value.form.validate()){const t=await ne({...a});console.log(t),t.code==200&&(c.ElMessage.success("修改成功"),w.value=!1,G())}},G=()=>{a.userid="",a.pwd="",a.pwdagagin=""},a=x({pwd:"",pwdagagin:""}),H=o({}),J=o({});return y({tableItemSelectionRef:v,customFormPwd:b}),(e,t)=>{const l=u("el-input"),m=u("el-button"),K=u("el-row"),O=u("el-header"),Q=u("el-main"),W=u("el-container");return fe(),de("div",ve,[s(W,null,{default:i(()=>[s(O,{class:"h-auto"},{default:i(()=>[s(K,{class:"flex-row flex-between"},{default:i(()=>[_("div",be,[s(l,{modelValue:C.search,"onUpdate:modelValue":t[0]||(t[0]=g=>C.search=g),placeholder:"输入账户或者名称"},null,8,["modelValue"]),s(m,{class:"ml-2",icon:n(Y),circle:"",onClick:d},null,8,["icon"])]),_("div",null,[s(m,{type:"primary",icon:n(ee),circle:"",onClick:N},null,8,["icon"]),s(m,{type:"danger",icon:n(te),circle:"",onClick:R},null,8,["icon"])])]),_:1})]),_:1}),s(Q,null,{default:i(()=>[s(n(ce),{ref_key:"tableItemSelectionRef",ref:v,"table-data":k.value,"table-title":L.value},null,8,["table-data","table-title"])]),_:1})]),_:1}),s(n(V),{visible:f.value,"onUpdate:visible":t[1]||(t[1]=g=>f.value=g),title:n(z),width:"60%"},{default:i(()=>[_("div",null,[s(n(U),{"form-items":n(q),form:r,rules:H.value,ref_key:"customFormref",ref:B},null,8,["form-items","form","rules"]),_("div",we,[s(m,{type:"primary",onClick:S},{default:i(()=>[p("确定")]),_:1})])])]),_:1},8,["visible","title"]),s(n(V),{visible:w.value,"onUpdate:visible":t[3]||(t[3]=g=>w.value=g),title:A.value,width:"20%"},{footer:i(()=>[_("span",_e,[s(m,{onClick:t[2]||(t[2]=g=>w.value=!1)},{default:i(()=>[p("退出")]),_:1}),s(m,{type:"primary",onClick:X},{default:i(()=>[p(" 确定 ")]),_:1})])]),default:i(()=>[s(n(U),{"form-items":j,form:a,rules:J.value,ref_key:"customFormPwd",ref:b},null,8,["form","rules"])]),_:1},8,["visible","title"])])}}};export{nt as default};
