import{M as S,B as z,P as A}from"../@element-plus/@element-plus.01e950e2.js";import{h as G}from"../../assets/index-30bdac58.js";import{r as H,d as J,f as K,u as O,a as Q}from"../role/role.56a83efa.js";import{D as W}from"../index/index.aae611ba.js";import{D as X}from"../index/index.78072cb3.js";import{D as Y}from"../index/index.41c9881b.js";import{x as Z,e as a,k as D,l as b,c as $,a4 as o,_ as m,u as i,an as r,a2 as v,o as ee,a as f}from"../@vue/@vue.133e0034.js";import{l as c}from"../element-plus/element-plus.8d403dde.js";import"../@ctrl/@ctrl.739734d8.js";import"../pinia/pinia.dbd2d364.js";import"../js-cookie/js-cookie.cf83ad76.js";import"../axios/axios.aba6f0e0.js";import"../geotiff/geotiff.41c905a7.js";import"../vue-router/vue-router.aebc008a.js";import"../fuse.js/fuse.js.88e2763d.js";import"../path-browserify/path-browserify.188d1ff8.js";import"../screenfull/screenfull.b3e6dc1f.js";import"../mitt/mitt.f7ef348c.js";import"../lodash-es/lodash-es.3689fb67.js";import"../@vueuse/@vueuse.902d2a47.js";import"../nprogress/nprogress.71449f25.js";/* empty css                                 */import"../clipboard/clipboard.860bb701.js";import"../vue-i18n/vue-i18n.dbf743d6.js";import"../@intlify/@intlify.771bffe6.js";import"../xe-utils/xe-utils.ae8f073f.js";import"../vxe-table/vxe-table.548b57f4.js";import"../vue3-lottie/vue3-lottie.24ecfee7.js";import"../lottie-web/lottie-web.c7050559.js";import"../@popperjs/@popperjs.d5d3bfa4.js";import"../dayjs/dayjs.aab16a72.js";import"../async-validator/async-validator.124ce023.js";import"../memoize-one/memoize-one.e2e9ba7a.js";import"../escape-html/escape-html.1d60d822.js";import"../normalize-wheel-es/normalize-wheel-es.2d7fa0bb.js";import"../@floating-ui/@floating-ui.c244c5cb.js";import"../vue/vue.b7c74ca4.js";import"../lodash-unified/lodash-unified.917db8bb.js";import"../news/news.8f1b56e5.js";function te(y){return G.request({method:"get",url:"/permisson/permissionList",data:y})}const oe={class:"common-layout"},se={class:"flex-row"},le={class:"flex justify-end"},He={__name:"roleList",setup(y,{expose:M}){Z(()=>{p(),B()});const p=async()=>{const{data:t}=await H(_);h.value=t},B=async()=>{const{data:t}=await te();C.data=t},h=a([]),u=a(null),w=D(()=>{var t;return((t=u==null?void 0:u.value)==null?void 0:t.multipleSelection)||[]}),E=async t=>{const{id:e}=t,{data:l}=await K({roleId:e});s.id=e,s.name=l.name,s.description=l.description,s.permission=l.permission,n.value=!0},F=a([{type:"selection"},{prop:"id",label:"ID"},{prop:"name",label:"角色名"},{prop:"description",label:"备注"},{prop:"setting",label:"操作",render:t=>o("div",{class:"flex"},[o(r("el-button"),{type:"primary",onClick:()=>E(t)},{default:()=>[v("编辑")]}),o(r("el-button"),{type:"danger",onClick:()=>k(t)},{default:()=>[v("删除")]})])}]),n=a(!1),x=a(null),T=a(null),V=D(()=>s.id?"编辑角色":"添加角色"),I=()=>{delete s.id,s.name="",s.permission=[],s.description="",n.value=!0},k=t=>{const e=w.value.length>0?w.value.map(l=>l.id):[t.id];if(e.length==0||e[e.length-1]==null){c.ElMessage.warning("至少选中一条数据");return}c.ElMessageBox.confirm("确定要删除这些选中角色吗",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await J({roleIds:e})).code==200&&(c.ElMessage({type:"success",message:"删除成功"}),p())})},C=b({data:[],showCheckbox:!0,nodekey:"id",checked:"",props:{children:"children",label:"name"}}),L=a([{prop:"name",label:"角色名",rules:[{required:!0,message:"必须输入账号",trigger:"blur"}]},{prop:"permission",is:"tree",option:C,label:"权限"},{prop:"description",label:"备注",type:"textarea"}]),_=b({search:""}),s=b({description:"",name:"",permission:[]}),R=async()=>{if(await x.value.form.validate())if(s.id){const e=await O(s);e.data&&(c.ElMessage({message:e.msg,type:"success"}),n.value=!1,p())}else{const e=await Q(s);e.data?(c.ElMessage({message:e.msg,type:"success"}),n.value=!1,p()):c.ElMessage.error(e.msg)}},N=a({});return M({tableItemSelectionRef:u,customFormPwd:T}),(t,e)=>{const l=r("el-input"),d=r("el-button"),U=r("el-row"),q=r("el-header"),P=r("el-main"),j=r("el-container");return ee(),$("div",oe,[o(j,null,{default:m(()=>[o(q,{class:"h-auto"},{default:m(()=>[o(U,{class:"flex-row flex-between"},{default:m(()=>[f("div",se,[o(l,{modelValue:_.search,"onUpdate:modelValue":e[0]||(e[0]=g=>_.search=g),placeholder:"输入名称或者备注"},null,8,["modelValue"]),o(d,{class:"ml-2",icon:i(S),circle:"",onClick:p},null,8,["icon"])]),f("div",null,[o(d,{type:"primary",icon:i(z),circle:"",onClick:I},null,8,["icon"]),o(d,{type:"danger",icon:i(A),circle:"",onClick:k},null,8,["icon"])])]),_:1})]),_:1}),o(P,null,{default:m(()=>[o(i(W),{ref_key:"tableItemSelectionRef",ref:u,"table-data":h.value,"table-title":F.value},null,8,["table-data","table-title"])]),_:1})]),_:1}),o(i(X),{visible:n.value,"onUpdate:visible":e[1]||(e[1]=g=>n.value=g),title:i(V),width:"60%","destroy-on-close":""},{default:m(()=>[f("div",null,[o(i(Y),{"form-items":L.value,form:s,rules:N.value,ref_key:"customFormref",ref:x},null,8,["form-items","form","rules"]),f("div",le,[o(d,{type:"primary",onClick:R},{default:m(()=>[v("确定")]),_:1})])])]),_:1},8,["visible","title"])])}}};export{He as default};
